**MOI (Mail/Message over IPFS)** - Система бессерверной система обмены файлами/сообщениями, работающая поверх IPFS.

##### Прицип работы:

Клиентские ноды содержат на /ipns/ точке питоновский словарь в пикл формате следующей структуры:

```
structure = 
{
'Public_encryption': 'public Alice key for encoding', 
'Public_signing': 'public Alice key for signing', 
'Message': 
	{'message_id_hash': #message_id_5383710b780583f1f462b6e719071523147cde25a5a47c380126c3395f84b9b3
	{'Address': address,  #e6jB08WPeBjoPS4Lb4CFRVW.....w6GLWYkY2vjhCgtux5vUuE+sKC97yMd9X9xhf5V8=
    'Files': ['Qm...', 'Qm...', 'Qm...']}},
    #... and other messages
'Points': []
}
```
**'Public_encryption'** - публичный ключ ECDH Curve25519 используемый для шифрования AES ключа, которым зашифрованы все вложенные файлы.

**'Public_signing'** - публичный ключ ECDSA Curve P-256, используемый для проверки подписи файлов в сообшениях.

**'Message'** 
-- ключ, в который входит всё, относящееся к сообщениям.

**'message_id_hash'** - ключ и некий идентификатор сообщения, служащий для того, чтобы отделять одни сообщения от других. В данном примере это “message_id_” скомпанованный с sha256 случайных байтов. Ключ включает в себя всё, связанное с конкретным сообщением

**'Address'** - шифрование_публичным_ключом_адресата(nonce, публичный ключ адресата или его часть)

**'Files'** - список всех файлов сообщения, включая текстовые, представленных в виде мультихэшей сети IPFS. Файл представляет собой питоновский словарь в формате пикл со структурой ключей 
_['Key', 'Nonce', 'Ciphertext', 'Tag', 'Signature']_

**'Key'** - AES ключ, зашифрованный 'Public_encryption' ключом отправителя (возможно добавление идентификатора, говорящего о том, зашифрован ли ключ или нет)

**'Nonce'** - случайная последовательность битов, служащая для улучшения шифрования

**'Ciphertext'** - зашифрованный файл

**'Tag'** - специальный таг, позволяющий определить аутентичность данных, расшифрованных предпологаемым ключом AES

**'Signature'** - криптографическая подпись, которой можно проверить аутентичность авторства при помощи 'Public_signing' ключа

Помимо этого внутри 'message_id_hash' ключа предполагается место для метаданных.
Таким образом структурированы и остальные сообщения, расположенные в ключе 'Message'

**'Points'** - обновляемый список IPNS нод, служащий для связности нодовой сети.


Предполагается для удобства пользователя сделать некое подобие ростера, где публичному ключу шифрования (и по возможности подписи) будет соответствовать ник. Также, возможно использование нескольких ключей, а также адресов, при незнании публичного ключа пользователя (в таком случае надо иметь ввиду, что сообщение необходимо будет посылать в открытом виде) 

___________________________________________________
MVP, так сказать, представляет собой консольное приложение, поддерживающее следующие команды:

_**init**_ - Первичная инициирование нового пользователя, генерация пар ключей. После этих процедур у пользователя запрашивается пароль для генерации AES ключа для шифрования секретных ключей (и, возможно, бд)
 
_**add-to-roster ‘instance‘ ‘username’**_ - назначить публичному ключу или адресу ник (а также возможно будет поддерживаться стягивание публичных ключей при подаче ipns ноды) 

_**check**_ - инициация процедуры проверки (характеристика количества проверяемых ipns нод или глубину проверяемых нод задаётся в файле конфигурации. В результате выдаётся нумерованный список из ников и новых сообщений (айди сообщений хранятся в бд и сравниваются). Пользователь может ввести номер сообщения, которое его интересует или выбрать все. После выбора создаётся папка с ником автора сообщения (если нету), а внутри неё - папка с айди сообщения, куда и скачиваются расшифрованные файлы.

_**send ‘folder’ ‘destination’**_- производит сообщение из файлов в папке и «отсылает» пользователю (можно в виде ника, публичного ключа или адреса). В последнем случае пользователю выдаётся предупреждение, что сообщение не будет зашифровано публичным ключом.

_**mop**_ - удаление всех папок с сообщениями от всех пользователей

_**show-pub enc/sign**_ - показывает публичный ключ для кодирования в hex формате / публичный ключ для проверки подписи в PEM формате

_**show-sec enc/sign**_ - показывает секретный ключ для кодирования в hex формате / секретный ключ для подписи в PEM формате. Перед показом пользователю выводится сообщение о секретности этой информации и просят ввести пароль.

И др.
  



 



